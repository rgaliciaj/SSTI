--CREACIÓN DE TRIGGERS

CREATE OR REPLACE TRIGGER TR_TICKET_ESTADO
AFTER UPDATE OF ESTADO_TICKET ON TICKET
FOR EACH ROW
BEGIN
    IF :OLD.ESTADO_TICKET <> :NEW.ESTADO_TICKET THEN
        INSERT INTO BITACORA_TICKET (ID, CODIGO_TICKET, USUARIO_MODIFICACION, ESTADOANTERIOR, ESTADONUEVO, ACCION)
        VALUES (SYS_GUID(), :NEW.CODIGO_TICKET, :NEW.CODIGO_USUARIO, :OLD.ESTADO_TICKET, :NEW.ESTADO_TICKET, 'CAMBIO DE ESTADO');
    END IF;
END;
/



CREATE OR REPLACE TRIGGER TR_NUEVO_TICKET
AFTER INSERT ON TICKET
FOR EACH ROW
BEGIN
    INSERT INTO BITACORA_TICKET (ID, CODIGO_TICKET, USUARIO_MODIFICACION, ESTADONUEVO, ACCION)
    VALUES (SYS_GUID(), :NEW.CODIGO_TICKET, :NEW.CODIGO_USUARIO, :NEW.ESTADO_TICKET, 'CREACIÓN DE TICKET');
END;
/



CREATE OR REPLACE TRIGGER TR_ELIMINAR_TICKET
AFTER DELETE ON TICKET
FOR EACH ROW
BEGIN
    INSERT INTO BITACORA_TICKET (ID, CODIGO_TICKET, USUARIO_MODIFICACION, ESTADOANTERIOR, ESTADONUEVO, ACCION)
    VALUES (SYS_GUID(), :OLD.CODIGO_TICKET, :OLD.CODIGO_USUARIO, :OLD.ESTADO_TICKET, NULL, 'ELIMINACION DE TICKET');
END;
/



